<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content="Academic Webpage"/>
    <meta name="author" content="hdp"/>
    <!-- 页面标题将从 YAML 中加载 -->
    <title id="title">博客文章</title>

    <!-- Icon -->
    <link rel="icon" type="image/x-icon" href="../../../static/assets/icon.png"/>

    <!-- Bootstrap icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet"/>

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,600;1,600&display=swap"
          rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,300;0,500;0,600;0,700;1,300;1,500;1,600;1,700&display=swap"
          rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;1,400&display=swap" rel="stylesheet"/>

    <!-- 样式 -->
    <link type="text/css" href="../../../static/css/styles.css" rel="stylesheet"/>
    <link type="text/css" href="../../../static/css/main.css" rel="stylesheet"/>

    <!-- Bootstrap JS -->
    <script type="text/javascript" src="../../../static/js/bootstrap.bundle.min.js"></script>
    <!-- Markdown 解析库 -->
    <script type="text/javascript" src="../../../static/js/marked.min.js"></script>
    <!-- YAML 解析库 -->
    <script type="text/javascript" src="../../../static/js/js-yaml.min.js"></script>

    <!-- 可选：MathJax（注意：避免同时加载多个版本） -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: false,
                processEnvironments: true,
                processRefs: true,
                digits: /^(?:[0-9]+(?:\{,\}[0-9]{3})*(?:\.[0-9]*)?|\.[0-9]+)/,
                tags: 'all',
                tagSide: 'right',
                tagIndent: '0.8em',
                useLabelIds: true,
                maxMacros: 10000,
                maxBuffer: 5 * 1024,
                formatError: (jax, err) => jax.formatError(err)
            }
        };
    </script>
    <!-- 仅加载一个 MathJax 脚本 -->
    <script type="text/javascript" id="MathJax-script"
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body id="page-top">

<!-- 导航部分 -->
<div id="navbar"></div>
<script>
    fetch('../../../navbar.html')
      .then(response => response.text())
      .then(data => { document.getElementById('navbar').innerHTML = data; })
      .catch(error => console.error('加载导航失败:', error));
</script>

<!-- 顶部背景部分 -->
<section class="top-section" id="top-section" style="background-image: url('Finews_pics/IM_2.jpeg');">
    <div class="top-section-content">
        <div class="container px-5">
            <!-- 顶部文本将从 YAML 中加载 -->
            <h2 id="top-section-bg-text" class="text-white display-3 lh-1 font-alt">默认顶部文本</h2>
        </div>
    </div>
</section>

<!-- 文章主体部分 -->
<section class="bg-gradient-primary-to-secondary-light mt5 md5" id="article">
    <div class="container">
        <header>
            <h2><i class="bi bi-file-text-fill"></i> 正文</h2>
            <!-- 文章日期（可选） -->
            <div id="article-date" class="text-muted"></div>
        </header>
        <!-- Markdown 文章内容 -->
        <div class="main-body vp-content" id="Finews-md"></div>
        <!-- YAML 中其他自定义变量示例 -->
<!--        <h2 id="website_name"></h2>-->
    </div>
</section>

<!-- 页脚部分，从全局配置中加载版权信息 -->
<footer class="bg-bottom text-center py-5">
    <div class="container px-5">
        <div class="text-white-50 small">
            <div id="copyright-text">
                &copy; Dapao Huang 2023-2025. All Rights Reserved.
            </div>
            <a id="github-link" href="https://github.com/cmdSTARMO">Github</a>
            <span class="mx-1">&middot;</span>
            <a id="license-link" href="https://github.com/cmdSTARMO/cmdstar.github.io/blob/main/LICENSE">License</a>
        </div>
    </div>
</footer>

<!-- 动态加载 YAML 与 Markdown 的脚本 -->
<script>
    // 获取 URL 参数 ?a_id=...
    function getQueryParam(param) {
      return new URLSearchParams(window.location.search).get(param);
    }

    // 通用加载 YAML 的函数（返回解析后的对象）
    function loadYAML(path) {
      return fetch(path)
        .then(response => response.text())
        .then(yamlText => jsyaml.load(yamlText));
    }

    // 加载当前文章（通过 URL 参数指定）
    function loadArticle(articleName) {
  // 根据实际存放位置调整路径
  const yamlPath = `./blog-folder/${articleName}.yml`;
  const mdPath = `./blog-folder/${articleName}.md`;

  loadYAML(yamlPath)
    .then(articleMeta => {
      // 遍历 YAML 中的每个键
      for (let key in articleMeta) {
        let elem = document.getElementById(key);
        if (elem) {
          if (key === "top_section_bg") {
            elem.style.backgroundImage = `url('${articleMeta[key]}')`;
          } else {
            elem.innerText = articleMeta[key];
          }
        }
      }
      return fetch(mdPath);
    })
    .then(response => response.text())
    .then(mdText => {
      const htmlContent = marked.parse(mdText);
      document.getElementById('Finews-md').innerHTML = htmlContent;
    })
    .catch(error => {
      console.error('加载文章出错:', error);
      document.getElementById('Finews-md').innerHTML = '<p>无法加载文章内容</p>';
    });
}

    // 加载全局配置（例如 footer 的版权信息），假设 config.yml 存放在根目录
    function loadConfig() {
      const configPath = '/config.yml';
      loadYAML(configPath)
        .then(config => {
          if (config && config.footer && config.footer.copyright) {
            document.getElementById('copyright-text').innerHTML = config.footer.copyright;
          }
        })
        .catch(error => {
          console.error('加载全局配置失败:', error);
        });
    }

    // 主程序：加载文章和全局配置
    const articleName = getQueryParam('a_id');
    if (articleName) {
      loadArticle(articleName);
    } else {
      document.getElementById('Finews-md').innerHTML = '<p>没有指定文章</p>';
    }
    loadConfig();
</script>
</body>
</html>